---
import { getCollection } from 'astro:content';

interface Props {
  activeCategory?: string;
  locale: string;
}

const { activeCategory, locale } = Astro.props;

const allPosts = await getCollection('blog', ({ data }) => data.draft !== true && data.locale === locale);
const categoryCounts = allPosts.reduce((acc, post) => {
  const cat = post.data.category;
  acc[cat] = (acc[cat] || 0) + 1;
  return acc;
}, {} as Record<string, number>);

const categories = Object.keys(categoryCounts).sort();
---

<div class="flex flex-wrap gap-2 mb-12 animate-fade-up">
  <a 
    href="/blog"
    class:list={[
      "px-4 py-2 rounded-xl text-xs font-bold uppercase tracking-widest transition-all border",
      !activeCategory 
        ? "bg-primary text-primary-foreground border-primary shadow-lg shadow-primary/20" 
        : "bg-muted/30 text-muted-foreground border-border/40 hover:border-primary/40 hover:text-primary"
    ]}
  >
    All
  </a>
  {categories.map((cat) => {
    const slug = cat.toLowerCase().replace(/[^a-z0-9]+/g, '-');
    const isActive = activeCategory === slug;
    
    return (
      <a 
        href={`/category/${slug}`}
        class:list={[
          "px-4 py-2 rounded-xl text-xs font-bold uppercase tracking-widest transition-all border",
          isActive 
            ? "bg-primary text-primary-foreground border-primary shadow-lg shadow-primary/20" 
            : "bg-muted/30 text-muted-foreground border-border/40 hover:border-primary/40 hover:text-primary"
        ]}
      >
        {cat} 
        <span class:list={["ml-1 opacity-50", { "text-primary-foreground/70": isActive }]}>
          ({categoryCounts[cat]})
        </span>
      </a>
    );
  })}
</div>
