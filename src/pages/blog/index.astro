---
import { getCollection } from 'astro:content';
import BlogList from '../../components/BlogList.astro';
import { getLocaleFromPath, getTranslations } from '../../lib/i18n';
import { siteConfig } from '../../config/site.config';

const locale = getLocaleFromPath(Astro.url.pathname);
const t = await getTranslations(locale);

const posts = await getCollection('blog', ({ data }) => {
  return data.draft !== true && data.locale === locale;
});

posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const paginationEnabled = siteConfig.features.pagination;
const postsPerPage = 6;
const totalPages = Math.ceil(posts.length / postsPerPage);

// Create a mock 'page' object compatible with BlogList props
const page = {
  data: paginationEnabled ? posts.slice(0, postsPerPage) : posts,
  currentPage: 1,
  lastPage: totalPages,
};
---

<BlogList 
  page={page}
  locale={locale}
  translations={t}
  baseUrl="/blog"
  title={t.blog.title}
  subtitle={t.blog.searchPlaceholder}
/>
